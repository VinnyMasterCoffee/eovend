<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Редактор инвентаризации кофе</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: inline-block; width: 180px; font-weight: bold; }
        input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px 20px; background: #4CAF50; color: white; border: none; cursor: pointer; }
        #status { margin: 15px 0; padding: 10px; border-radius: 4px; }
        .loading { background: #fff3cd; color: #856404; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .error-input { border-color: #f8d7da !important; }
    </style>
</head>
<body>
    <h2>Редактор инвентаризации кофе</h2>
    
    <div id="status" class="loading">Загрузка шаблона...</div>

    <div class="form-group">
        <label>Дата инвентаризации:</label>
        <input type="date" id="inventoryDate" required>
    </div>
    
    <div class="form-group">
        <label>Номер маршрута (К):</label>
        <input type="text" id="routeNumber" required placeholder="Например: 123">
        <label style="margin-left: 20px;">Номер машины:</label>
        <input type="text" id="carNumber" required placeholder="Например: А123БВ">
    </div>

    <h3>Фактические остатки:</h3>
    <div id="inventoryInputs"></div>

    <button id="downloadBtn" disabled>Скачать обновлённый файл</button>

    <script>
        // Конфигурация
        const TEMPLATE_PATH = '/templates/invent.xlsx'; // Исправленный путь к шаблону
        const monthNames = {
            nom: ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь", 
                  "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"],
            dat: ["января", "февраля", "марта", "апреля", "мая", "июня", 
                  "июля", "августа", "сентября", "октября", "ноября", "декабря"]
        };

        // Полный список товаров для редактирования (E6-E21 кроме исключений)
        const inventoryItems = [
            { id: 1, name: "Вода Нила Спрингс 19л" },
            { id: 2, name: "Горячий шоколад ARISTOCRAT ШВЕЙЦАРСКИЙ гранулы 500г" },
            { id: 3, name: "Какао ARISTOCRAT ШВЕЙЦАРСКИЙ 500г" },
            { id: 4, name: "Капучино ARISTOCRAT CLASSICO 500г" },
            { id: 5, name: "Капучино ARISTOCRAT VANILLA 500г" },
            { id: 6, name: "Капучино ARISTOCRAT CARAMEL 500г" },
            { id: 7, name: "Кофе молотый ARISTOCRAT COLUMBIA 500г" },
            { id: 8, name: "Кофе молотый ARISTOCRAT BRAZIL 500г" },
            { id: 9, name: "Кофе растворимый ARISTOCRAT GOLD 500г" },
            { id: 10, name: "Кофе растворимый ARISTOCRAT CLASSIC 500г" },
            { id: 11, name: "Латте ARISTOCRAT CLASSICO 500г" },
            { id: 12, name: "Латте ARISTOCRAT VANILLA 500г" },
            { id: 13, name: "Латте ARISTOCRAT CARAMEL 500г" },
            { id: 14, name: "Сахар-песок 1кг" },
            { id: 15, name: "Сливки сухие ARISTOCRAT 1кг" },
            { id: 16, name: "Смесь сухая ARISTOCRAT Клубника 1кг", editable: false }
        ].filter(item => item.editable !== false);

        let workbookTemplate = null;

        // Загрузка шаблона при старте
        async function loadTemplate() {
            try {
                const statusEl = document.getElementById('status');
                
                // 1. Загружаем шаблон
                statusEl.textContent = "Загрузка шаблона...";
                const response = await fetch(TEMPLATE_PATH);
                
                if (!response.ok) throw new Error(`Ошибка HTTP: ${response.status}`);
                
                const data = await response.arrayBuffer();
                workbookTemplate = XLSX.read(data);
                
                // 2. Проверяем структуру
        
